<script>
document.addEventListener("DOMContentLoaded", function() {
    const sheetAPI = "https://script.google.com/macros/s/AKfycbyHEH_R7V38om7G8Jma10P0UBvuh1cfsI9PqbpWARj9iOSOdnP3FBPtrr8lCP9GeZd_/exec"; 

    let dispenserId = "";
    const registrarBtn = document.getElementById("registrar");
    const usuarioInput = document.getElementById("usuarioInput");

    function verificarBoton() {
        console.log("üîÑ Verificando si el bot√≥n debe estar habilitado...");
        if (usuarioInput.value.trim() !== "" && dispenserId !== "") {
            registrarBtn.disabled = false;
            console.log("‚úÖ Bot√≥n habilitado");
        } else {
            registrarBtn.disabled = true;
            console.log("‚ùå Bot√≥n deshabilitado");
        }
    }

    usuarioInput.addEventListener("input", verificarBoton);

    registrarBtn.addEventListener("click", async () => {
        console.log("üõ† Bot√≥n 'Registrar Recarga' fue presionado");

        let usuario = usuarioInput.value.trim();
        if (!usuario) {
            alert("‚ö†Ô∏è Por favor, ingresa tu nombre.");
            return;
        }

        const requestData = { dispenser: dispenserId, usuario };
        console.log("üì§ Enviando datos:", requestData);

        try {
            const response = await fetch(sheetAPI, {
                method: "POST",
                body: JSON.stringify(requestData),
                headers: { "Content-Type": "application/json" }
            });

            const responseData = await response.text();
            console.log("‚úÖ Respuesta del servidor:", responseData);
            document.getElementById("mensaje").innerText = responseData;
        } catch (error) {
            console.error("‚ùå Error al enviar datos:", error);
            document.getElementById("mensaje").innerText = "Error al registrar. Intenta de nuevo.";
        }
    });
});
</script>
